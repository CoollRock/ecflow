<div class="highlight"><pre><span class="c">#!/usr/local/bin/python</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">signal</span>
<span class="n">ECF_PORT</span> <span class="o">=</span> <span class="o">^</span><span class="n">ECF_PORT</span><span class="p">:</span><span class="mi">0</span><span class="o">^</span>
<span class="n">XECF</span> <span class="o">=</span> <span class="s">&quot;ecflow_client &quot;</span>
<span class="n">XECF</span> <span class="o">+=</span> <span class="s">&quot;--port </span><span class="si">%s</span><span class="s"> --host ^ECF_HOST:0^ &quot;</span><span class="o">%</span><span class="n">ECF_PORT</span>
<span class="n">XSVR</span><span class="o">=</span><span class="s">&quot;sms&quot;</span>
<span class="k">if</span> <span class="n">ECF_PORT</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">XSVR</span> <span class="o">=</span> <span class="n">XECF</span> <span class="o">+</span> <span class="s">&quot;--&quot;</span>
<span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">call_init</span><span class="p">():</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">XSVR</span> <span class="o">+</span> <span class="s">&quot;init </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">pid</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">call_abort</span><span class="p">():</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">XSVR</span> <span class="o">+</span> <span class="s">&quot;abort </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">pid</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">call_complete</span><span class="p">():</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">XSVR</span> <span class="o">+</span> <span class="s">&quot;complete&quot;</span><span class="p">)</span>  
<span class="k">def</span> <span class="nf">SigHandler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span> 
    <span class="n">call_abort</span><span class="p">();</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span>  <span class="n">SigHandler</span><span class="p">);</span> <span class="c"># ...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ECF_PORT</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;ECF_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;^ECF_PORT:0^&quot;</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;ECF_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;^ECF_NAME:0^&quot;</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;ECF_HOST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;^ECF_HOST:0^&quot;</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;ECF_PASS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;^ECF_PASS:0^&quot;</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;SMS_PROG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;^SMS_PROG:0^&quot;</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;SMSNAME&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s">&quot;^SMSNAME:0^&quot;</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;SMSNODE&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s">&quot;^SMSNODE:0^&quot;</span>
  <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;SMSPASS&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s">&quot;^SMSPASS:0^&quot;</span>

<span class="k">def</span> <span class="nf">call_meter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
   <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">XSVR</span> <span class="o">+</span> <span class="s">&quot;meter </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">step</span><span class="p">))</span>  
<span class="k">def</span> <span class="nf">call_event</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
   <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">XSVR</span> <span class="o">+</span> <span class="s">&quot;event </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>  
<span class="k">def</span> <span class="nf">call_label</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
   <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">XSVR</span> <span class="o">+</span> <span class="s">&quot;label </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">info</span><span class="p">))</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGHUP</span><span class="p">,</span>  <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGQUIT</span><span class="p">,</span> <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGILL</span><span class="p">,</span>  <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTRAP</span><span class="p">,</span> <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGIOT</span><span class="p">,</span>  <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGBUS</span><span class="p">,</span>  <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGFPE</span><span class="p">,</span>  <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGUSR1</span><span class="p">,</span> <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGUSR2</span><span class="p">,</span> <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGPIPE</span><span class="p">,</span> <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGXCPU</span><span class="p">,</span> <span class="n">SigHandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGPWR</span><span class="p">,</span>  <span class="n">SigHandler</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;start&#39;</span>
<span class="n">call_init</span><span class="p">()</span>
</pre></div>
